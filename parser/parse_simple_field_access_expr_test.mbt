/// ================================================================================
/// # ApplyExpr çš„ç»ˆç« ï¼šç»“æ„ä½“å­—æ®µè®¿é—®
///
/// æˆ‘ä»¬å·²ç»å®Œæˆäº† `ApplyExpr` çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œç°åœ¨åªå‰©ä¸‹æœ€åä¸€ç§ï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„ä¸€ç§ï¼š
/// **ç»“æ„ä½“å­—æ®µè®¿é—®ï¼ˆStruct Field Accessï¼‰**ã€‚
///
/// ## å­—æ®µè®¿é—®è¯­æ³•
///
/// å­—æ®µè®¿é—®çš„è¯­æ³•æ˜¯é€šè¿‡ç‚¹å· `.` æ¥è®¿é—®ä¸€ä¸ªç»“æ„ä½“å®ä¾‹çš„æˆå‘˜ï¼š`my_struct.field_name`ã€‚
/// è¿™é‡Œçš„ `my_struct` æ˜¯ä¸€ä¸ª `ApplyExpr`ï¼Œè€Œ `field_name` æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆ`Lower` Tokenï¼‰ã€‚
///
/// ## ğŸ¯ ä½ çš„ä»»åŠ¡ï¼šåœ¨ `parse_apply_expr` ä¸­å¤„ç† `.`
///
/// æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æœ€ç»ˆå®Œå–„ `parser/apply_expr.mbt` ä¸­çš„ `parse_apply_expr` å‡½æ•°ï¼Œ
/// ä½¿å…¶èƒ½å¤Ÿå¤„ç†å­—æ®µè®¿é—®ï¼Œå¹¶èƒ½å¤Ÿä¸æ•°ç»„ç´¢å¼•ã€å‡½æ•°è°ƒç”¨ç­‰æ— ç¼è¡”æ¥ã€‚
///
/// **å®ç°æ€è·¯ï¼š**
///
/// è¿™éƒ¨åˆ†é€»è¾‘å¯ä»¥å®Œç¾åœ°èå…¥æˆ‘ä»¬ä¸ºå¤„ç†æ•°ç»„ç´¢å¼•å’Œå‡½æ•°è°ƒç”¨è€Œæ„å»ºçš„å¾ªç¯ä¸­ã€‚
///
/// 1.  **è§£æåŸºç¡€ï¼š** å‡½æ•°é¦–å…ˆè§£æå‡ºä¸€ä¸ªåŸºç¡€çš„ `ApplyExpr`ã€‚
///
/// 2.  **å¾ªç¯å‘åçœ‹ï¼š** åœ¨å¾ªç¯ä¸­ï¼Œæ£€æŸ¥åŸºç¡€è¡¨è¾¾å¼åé¢çš„ Tokenã€‚
///
/// 3.  **åŒ¹é… `.`ï¼š**
///     *   å¦‚æœä¸‹ä¸€ä¸ª Token æ˜¯ `.`ï¼Œé‚£ä¹ˆè¯´æ˜ä¸€ä¸ªå­—æ®µè®¿é—®å¼€å§‹äº†ã€‚
///     *   è·³è¿‡ `.`ã€‚
///     *   **ç‰¹åˆ«æ³¨æ„ï¼š** å­—æ®µåå¿…é¡»æ˜¯ä¸€ä¸ªå°å†™å­—æ¯å¼€å¤´çš„æ ‡è¯†ç¬¦ã€‚æ‰€ä»¥ï¼Œä½ éœ€è¦æ£€æŸ¥ç´§è·Ÿåœ¨ `.` åé¢çš„ Token æ˜¯å¦ä¸º `TokenKind::Lower`ã€‚
///     *   å¦‚æœåŒ¹é…æˆåŠŸï¼Œæå–å‡ºå­—æ®µåï¼ˆä¸€ä¸ª `String`ï¼‰ã€‚
///     *   ç°åœ¨ï¼Œä½ æ‹¥æœ‰äº†â€œè¢«è®¿é—®çš„å¯¹è±¡â€ï¼ˆ`object`ï¼‰å’Œâ€œå­—æ®µåâ€ï¼ˆ`field`ï¼‰ã€‚
///       ç”¨å®ƒä»¬æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç±»å‹ä¸º `FieldAccess` çš„ `ApplyExpr`ã€‚
///
/// 4.  **é“¾å¼è®¿é—®ï¼š**
///     *   è¿™ä¸ªæ–°çš„ `FieldAccess` è¡¨è¾¾å¼ä¼šåŒ…è£¹ä½æ—§çš„ `ApplyExpr`ã€‚åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œå®ƒåˆå¯ä»¥ä½œä¸º
///       `obj.field1.field2` æˆ– `obj.field[0]` æˆ– `obj.method()` ç­‰æ›´å¤æ‚é“¾å¼æ“ä½œçš„åŸºç¡€ã€‚
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€éªŒä½ çš„å®ç°ï¼š
///
/// ```bash
/// moon test -p parser -f parse_simple_field_access_expr_test.mbt
/// ```
///
/// **ç¥è´ºä½ ï¼å®Œæˆè¿™ä¸€æ­¥åï¼Œä½ çš„ `parse_apply_expr` å‡½æ•°å°±å½»åº•å®Œå·¥äº†ã€‚ä½ å·²ç»æ„å»ºäº†ä¸€ä¸ªèƒ½å¤Ÿè§£æ MiniMoonBit ä¸­æ‰€æœ‰å¤æ‚è¡¨è¾¾å¼ç»„åˆçš„å¼ºå¤§è§£æå™¨ï¼**
/// ================================================================================

///|
test "Simple Field Access Parsing Test" {
  let code =
    #|obj.field
    #|obj.nested.field
  let tokens = @lexer.tokenize(code)
  let (a, tok_view) = parse_apply_expr(tokens[:])
  assert_true(
    a.kind is ApplyExprKind::FieldAccess(obj_access, field) &&
    field == "field" &&
    obj_access.kind is ApplyExprKind::AtomExpr(atom_obj) &&
    atom_obj.kind is AtomExprKind::Ident("obj"),
  )
  let (a, _) = parse_apply_expr(tok_view)
  assert_true(
    a.kind is ApplyExprKind::FieldAccess(nested_access, field2) &&
    field2 == "field" &&
    nested_access.kind is ApplyExprKind::FieldAccess(obj_access2, field1) &&
    field1 == "nested" &&
    obj_access2.kind is ApplyExprKind::AtomExpr(atom_obj2) &&
    atom_obj2.kind is AtomExprKind::Ident("obj"),
  )
}
