/// ================================================================================
/// # è‡ªå®šä¹‰ç±»å‹ï¼šè§£æç»“æ„ä½“å®šä¹‰
///
/// æˆ‘ä»¬å·²ç»èƒ½å¤Ÿè§£æ MiniMoonBit çš„æ‰€æœ‰å†…ç½®ç±»å‹å’Œè¯­å¥äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ·»åŠ ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼š
/// å…è®¸ç”¨æˆ·**è‡ªå®šä¹‰ç±»å‹**ï¼Œå³**ç»“æ„ä½“ï¼ˆStructï¼‰**ã€‚
///
/// ç»“æ„ä½“å…è®¸æˆ‘ä»¬å°†å¤šä¸ªä¸åŒç±»å‹çš„å€¼ç»„åˆæˆä¸€ä¸ªæ–°çš„ã€æœ‰åå­—çš„ç±»å‹ã€‚
///
/// ## ç»“æ„ä½“å®šä¹‰çš„ EBNF èŒƒå¼
///
/// ```
/// struct_def ::= "struct" ident "{" (field_def (";" field_def)* ";"? )? "}"
/// field_def  ::= ("mut")? ident ":" type
/// ```
///
/// è¿™æ®µèŒƒå¼å‘Šè¯‰æˆ‘ä»¬ï¼š
/// 1.  ä»¥ `struct` å…³é”®å­—å’Œç±»å‹åï¼ˆå¤§å†™å­—æ¯å¼€å¤´çš„ `ident`ï¼‰å¼€å§‹ã€‚
/// 2.  `{}` å†…éƒ¨æ˜¯å­—æ®µåˆ—è¡¨ã€‚
/// 3.  æ¯ä¸ªå­—æ®µ `field_def` åŒ…å«ä¸€ä¸ªå¯é€‰çš„ `mut` å…³é”®å­—ã€ä¸€ä¸ªå­—æ®µåï¼ˆå°å†™å­—æ¯å¼€å¤´çš„ `ident`ï¼‰å’Œä¸€ä¸ªç±»å‹ã€‚
/// 4.  å­—æ®µä¹‹é—´å¿…é¡»ç”¨åˆ†å· `;` åˆ†éš”ã€‚
///
/// ## ğŸ¯ ä½ çš„ä»»åŠ¡ï¼šå®ç° `parse_struct_def`
///
/// ä½ çš„ä»»åŠ¡æ˜¯åœ¨ `parser/struct_def.mbt` ä¸­å®ç° `parse_struct_def` å‡½æ•°ã€‚
///
/// **å®ç°æ€è·¯ï¼š**
///
/// 1.  è§£æ `struct` å…³é”®å­—å’Œç»“æ„ä½“åç§°ã€‚
/// 2.  è§£æå¼€å¤´çš„ `{"{"`ã€‚
/// 3.  è¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œè§£æ `{"{""}"}` å†…éƒ¨çš„å­—æ®µåˆ—è¡¨ã€‚å¾ªç¯çš„ç»ˆæ­¢æ¡ä»¶æ˜¯é‡åˆ° `"}"`ã€‚
/// 4.  åœ¨å¾ªç¯å†…éƒ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° `parse_struct_field` æ¥è§£æå•ä¸ªå­—æ®µã€‚è¿™ä¸ªå‡½æ•°è´Ÿè´£è§£æå¯é€‰çš„ `mut`ã€å­—æ®µåã€å†’å·å’Œç±»å‹ï¼Œå¹¶è¦æ±‚åé¢å¿…é¡»è·Ÿä¸€ä¸ªåˆ†å·ã€‚
/// 5.  è§£æç»“å°¾çš„ `"}"`ã€‚
///
/// è¿™ä¸ªç»“æ„ä¸è§£æä»£ç å— `block_expr` éå¸¸ç›¸ä¼¼ï¼Œç›¸ä¿¡ä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚
///
/// åŠ æ²¹ï¼è¿™æ˜¯æˆ‘ä»¬ä¸ºè¯­è¨€æ·»åŠ å¤åˆæ•°æ®ç±»å‹çš„å…³é”®ä¸€æ­¥ã€‚
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// ```bash
/// moon test -p parser -f parse_struct_def_test.mbt
/// ```
/// ================================================================================

///|
test "Struct Def Parsing Test" {
  let code =
    #|struct Point {
    #|  x: Int;
    #|  mut y: Int;
    #|  z: Double;
    #|}
  let tokens = @lexer.tokenize(code)
  let (struct_def, _) = parse_struct_def(tokens)
  assert_true(struct_def.name is "Point")
  assert_true(struct_def.fields.length() is 3)
  assert_true(struct_def.fields[0] is { name: "x", is_mut: false, .. })
  assert_true(struct_def.fields[0].ty is { kind: Int })
  assert_true(struct_def.fields[1] is { name: "y", is_mut: true, .. })
  assert_true(struct_def.fields[1].ty is { kind: Int })
  assert_true(struct_def.fields[2] is { name: "z", is_mut: false, .. })
  assert_true(struct_def.fields[2].ty is { kind: Double })
}
