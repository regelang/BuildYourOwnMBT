/// ================================================================================
/// # å¯å˜å˜é‡ï¼šè§£æ let mut è¯­å¥
///
/// æˆ‘ä»¬å·²ç»å¯ä»¥è§£æä¸å¯å˜çš„ `let` ç»‘å®šäº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å¤„ç†å®ƒçš„â€œå…„å¼Ÿâ€ï¼š
/// `let mut` è¯­å¥ï¼Œå®ƒç”¨äºå£°æ˜ä¸€ä¸ª**å¯å˜å˜é‡**ã€‚
///
/// ## `let mut` è¯­å¥çš„ EBNF èŒƒå¼
///
/// `let mut` è¯­å¥çš„ç»“æ„ä¸ `let` éå¸¸ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼š
///
/// ```
/// let_mut_stmt ::= "let" "mut" ident (":" type)? "=" expr ";"
/// ```
///
/// **âš ï¸ è¯·åŠ¡å¿…æ³¨æ„ï¼š**
/// `let mut` çš„å·¦è¾¹åªèƒ½æ˜¯ä¸€ä¸ª**å•ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆ`ident`ï¼‰**ï¼Œè€Œ**ä¸æ˜¯**åƒ `let` é‚£æ ·å¯ä»¥æ˜¯å¤æ‚çš„æ¨¡å¼ï¼ˆ`pattern`ï¼‰ã€‚
/// è¿™æ˜¯ MiniMoonBit çš„ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼Œæ„å‘³ç€ä½ ä¸èƒ½å†™ `let mut (a, b) = ...` è¿™æ ·çš„ä»£ç ã€‚
///
/// ## ğŸ¯ ä½ çš„ä»»åŠ¡ï¼šå®ç° `parse_let_mut_stmt`
///
/// ä½ çš„ä»»åŠ¡æ˜¯åœ¨ `parser/let_mut_stmt.mbt` ä¸­å®ç° `parse_let_mut_stmt` å‡½æ•°ã€‚
///
/// è¿™ä¸ªä»»åŠ¡çš„æµç¨‹ä¸ `parse_let_stmt` é«˜åº¦ä¸€è‡´ï¼Œä½ åªéœ€è¦ï¼š
/// 1.  åŒ¹é… `let mut` è¿™ä¸¤ä¸ªè¿ç»­çš„å…³é”®å­—ã€‚
/// 2.  ç¡®ä¿åé¢è·Ÿç€çš„æ˜¯ä¸€ä¸ª `Lower` ç±»å‹çš„ Token ä½œä¸ºæ ‡è¯†ç¬¦ã€‚
/// 3.  å…¶ä½™éƒ¨åˆ†ï¼ˆå¯é€‰çš„ç±»å‹ã€`=`ã€è¡¨è¾¾å¼å’Œ `;`ï¼‰çš„è§£æä¸ `let` è¯­å¥å®Œå…¨ç›¸åŒã€‚
///
/// ç›¸ä¿¡è¿™å¯¹ä½ æ¥è¯´å·²ç»éå¸¸ç®€å•äº†ã€‚åŠ æ²¹ï¼
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// ```bash
/// moon test -p parser -f parse_let_mut_stmt_test.mbt
/// ```
/// ================================================================================

///|
test "Let Mut Stmt Parsing Test" {
  let code =
    #|let mut x : Int = 42;
    #|let mut y = 100;
    #|let mut z : (Int, Double) = (1, 2.0);
  let tokens = @lexer.tokenize(code)
  let (s, tok_view) = parse_let_mut_stmt(tokens)
  assert_true(
    s.name is "x" &&
    s.ty is Some(ty) &&
    ty.kind is Int &&
    s.expr.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Int(42),
  )
  let (s, tok_view) = parse_let_mut_stmt(tok_view)
  assert_true(
    s.name is "y" &&
    s.ty is None &&
    s.expr.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Int(100),
  )
  let (s, _) = parse_let_mut_stmt(tok_view)
  assert_true(
    s.name is "z" &&
    s.ty is Some(ty) &&
    ty.kind is Tuple(tys) &&
    tys is [ty1, ty2] &&
    ty1 is Int &&
    ty2 is Double &&
    s.expr.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Tuple(es) &&
    es is [e1, e2] &&
    e1.kind is ApplyExpr(a1) &&
    a1.kind is AtomExpr(atom1) &&
    atom1.kind is Int(1) &&
    e2.kind is ApplyExpr(a2) &&
    a2.kind is AtomExpr(atom2) &&
    atom2.kind is Double(2.0),
  )
}
