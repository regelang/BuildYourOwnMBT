/// ================================================================================
/// # è¡¨è¾¾å¼çš„å±‚çº§ï¼šExpr
///
/// æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°† `AtomExpr` åŒ…è£…è¿›äº† `ApplyExpr`ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™å¼•å…¥æˆ‘ä»¬è¯­æ³•æ ‘ä¸­
/// æœ€æ ¸å¿ƒã€æœ€é€šç”¨çš„èŠ‚ç‚¹ä¹‹ä¸€ï¼š**`Expr`**ã€‚
///
/// ## ä»€ä¹ˆæ˜¯ Exprï¼Ÿ
///
/// `Expr`ï¼ˆè¡¨è¾¾å¼ï¼‰æ˜¯ MiniMoonBit ä¸­èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ªå€¼çš„å‡ ä¹æ‰€æœ‰ä»£ç æ„é€ çš„ç»Ÿç§°ã€‚
/// å®ƒæ˜¯æˆ‘ä»¬è¯­æ³•è§„åˆ™çš„â€œç‘å£«å†›åˆ€â€ï¼Œæ¶µç›–äº†ä»æœ€ç®€å•çš„æ•°å­—åˆ°æœ€å¤æ‚çš„é€»è¾‘å—çš„æ‰€æœ‰å†…å®¹ã€‚
///
/// `Expr` ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§å½¢å¼ï¼š
///
/// 1.  **ä¸€å…ƒæ“ä½œï¼š** `-x` (å–å), `!b` (é€»è¾‘é)
/// 2.  **äºŒå…ƒæ“ä½œï¼š** `a + b`, `x > y`
/// 3.  **If è¡¨è¾¾å¼ï¼š** `if condition { ... } else { ... }`
/// 4.  **Block è¡¨è¾¾å¼ï¼š** `{ let a = 1; a + 1 }`
/// 5.  **ä»¥åŠæˆ‘ä»¬åˆšåˆšå®ç°çš„ `ApplyExpr`ï¼š** å®ƒä½œä¸ºæ‰€æœ‰å¤æ‚è¡¨è¾¾å¼çš„åŸºç¡€ã€‚
///
/// ## ğŸ¯ ä½ çš„ä»»åŠ¡ï¼šå®ç°æœ€ç®€å•çš„ Expr
///
/// åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨â€œç”±ç®€å…¥ç¹â€çš„ç­–ç•¥ã€‚æˆ‘ä»¬é¦–å…ˆè¦è®© `parse_expr` å‡½æ•°
/// èƒ½å¤Ÿå¤„ç†æœ€åŸºç¡€çš„æƒ…å†µï¼šä¸€ä¸ªå•ç‹¬çš„ `ApplyExpr`ã€‚
///
/// è¯·ä¿®æ”¹ `parser/expr.mbt` æ–‡ä»¶ä¸­çš„ `parse_expr` å‡½æ•°ã€‚
///
/// **å®ç°æ€è·¯ï¼š**
///
/// 1.  åœ¨ `parse_expr` å‡½æ•°å†…éƒ¨ï¼Œç›´æ¥è°ƒç”¨æˆ‘ä»¬å·²ç»å®Œæˆçš„ `parse_apply_expr`ã€‚
/// 2.  æˆåŠŸè§£æå‡º `ApplyExpr` åï¼Œç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª `Expr` èŠ‚ç‚¹ã€‚
///    ï¼ˆæç¤ºï¼š`Expr` çš„å®šä¹‰ä¸­æœ‰ä¸€ä¸ª `ApplyExpr(ApplyExpr)` çš„æ„é€ å™¨ï¼‰ã€‚
/// 3.  æš‚æ—¶ä¸éœ€è¦è€ƒè™‘ä»»ä½•äºŒå…ƒæ“ä½œã€ä¸€å…ƒæ“ä½œæˆ–å…¶ä»–å¤æ‚æƒ…å†µã€‚æˆ‘ä»¬åªå¤„ç†ä¸€ä¸ª `ApplyExpr` å°±ç›´æ¥è¿”å›ã€‚
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€éªŒä½ çš„å®ç°ï¼š
///
/// ```bash
/// moon test -p parser -f parse_simple_expr_test.mbt
/// ```
///
/// è¿™ä¸ªæµ‹è¯•å°†ç¡®ä¿ä½ çš„ `parse_expr` èƒ½å¤Ÿæ­£ç¡®åœ°å°†ä¸€ä¸ª `ApplyExpr` åŒ…è£…æˆ `Expr`ã€‚
///
/// **ç¥ä½ é¡ºåˆ©ï¼æˆ‘ä»¬æ­£åœ¨é€æ­¥æ„å»ºèµ·èƒ½å¤Ÿç†è§£å¤æ‚ä»£ç é€»è¾‘çš„è§£æå™¨ï¼**
/// ================================================================================

///|
test "Simple Expr Parsing Test" {
  let code =
    #|42 3.14 true false
    #|a
  let tokens = @lexer.tokenize(code)
  let (e, tok_view) = parse_expr(tokens[:])
  assert_true(
    e.kind is ApplyExpr(a) && a.kind is AtomExpr(atom) && atom.kind is Int(42),
  )
  let (e, tok_view) = parse_expr(tok_view)
  assert_true(
    e.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Double(3.14),
  )
  let (e, tok_view) = parse_expr(tok_view)
  assert_true(
    e.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Bool(true),
  )
  let (e, tok_view) = parse_expr(tok_view)
  assert_true(
    e.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Bool(false),
  )
  let (e, _) = parse_expr(tok_view)
  assert_true(
    e.kind is ApplyExpr(a) &&
    a.kind is AtomExpr(atom) &&
    atom.kind is Ident("a"),
  )
}
