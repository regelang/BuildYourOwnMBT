/// ================================================================================
/// # è¡¨è¾¾å¼è§£æžçš„æœ€ç»ˆç« ï¼šç»„åˆä¸€åˆ‡
///
/// æ­å–œä½ ï¼ä½ å·²ç»åˆ†åˆ«æž„å»ºäº† `ApplyExpr`ã€`IfExpr`ã€`BlockExpr` ä»¥åŠå¤„ç†ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œçš„å„ç§é€»è¾‘ã€‚
/// çŽ°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ°äº†è¡¨è¾¾å¼è§£æžçš„æœ€åŽä¸€ç«™ï¼šå°†æ‰€æœ‰è¿™äº›éƒ¨åˆ†åœ¨ `parse_expr` å‡½æ•°ä¸­å®Œç¾Žåœ°ç»„åˆèµ·æ¥ã€‚
///
/// ## è¡¨è¾¾å¼çš„â€œåˆ†è¯Šå°â€
///
/// `parse_expr` å‡½æ•°å°±åƒä¸€ä¸ªæ€¥è¯Šå®¤çš„åˆ†è¯Šå°ã€‚å½“ä¸€ä¸² Token åˆ°æ¥æ—¶ï¼Œå®ƒéœ€è¦å¿«é€Ÿåˆ¤æ–­è¿™å±žäºŽå“ªç§â€œç—…ä¾‹â€ï¼Œ
/// ç„¶åŽå°†å…¶åˆ†å‘ç»™å¯¹åº”çš„â€œä¸“ç§‘åŒ»ç”Ÿâ€ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰å†™çš„å„ä¸ªå­è§£æžå™¨ï¼‰ã€‚
///
/// ## ðŸŽ¯ ä½ çš„ä»»åŠ¡ï¼šå®Œå–„ `parse_expr`
///
/// ä½ çš„ä»»åŠ¡æ˜¯æœ€åŽä¸€æ¬¡ä¿®æ”¹ `parser/expr.mbt` ä¸­çš„ `parse_expr` å‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†æ‰€æœ‰ç±»åž‹çš„è¡¨è¾¾å¼ã€‚
///
/// **å®žçŽ°æ€è·¯ï¼š**
///
/// 1.  **ç‰¹æ®Šæƒ…å†µä¼˜å…ˆï¼š**
///     *   é¦–å…ˆï¼Œæ£€æŸ¥å¼€å¤´çš„ Token æ˜¯å¦æ˜¯ `if` æˆ– `{`ã€‚å¦‚æžœæ˜¯ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ª `IfExpr` æˆ– `BlockExpr`ï¼Œ
///       ç›´æŽ¥è°ƒç”¨å¯¹åº”çš„ `parse_if_expr` æˆ– `parse_block_expr` å‡½æ•°ï¼Œç„¶åŽè¿”å›žç»“æžœã€‚
///     *   æŽ¥ç€ï¼Œæ£€æŸ¥å¼€å¤´æ˜¯å¦æ˜¯ä¸€å…ƒæ“ä½œç¬¦ï¼ˆ`!` æˆ– `-`ï¼‰ã€‚å¦‚æžœæ˜¯ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰å®žçŽ°çš„ä¸€å…ƒæ“ä½œé€»è¾‘è¿›è¡Œè§£æžã€‚
///
/// 2.  **é»˜è®¤æƒ…å†µï¼š**
///     *   å¦‚æžœä»¥ä¸Šæƒ…å†µéƒ½ä¸åŒ¹é…ï¼Œé‚£ä¹ˆå®ƒå¿…ç„¶æ˜¯ä¸€ä¸ªä»¥ `ApplyExpr` å¼€å¤´çš„è¡¨è¾¾å¼ï¼Œ
///       åŽé¢å¯èƒ½è·Ÿç€ä¸€ç³»åˆ—çš„äºŒå…ƒæ“ä½œç¬¦ï¼ˆä¾‹å¦‚ `a + b * c`ï¼‰ã€‚
///     *   åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰§è¡Œæˆ‘ä»¬ä¸ºäºŒå…ƒæ“ä½œç¬¦å®žçŽ°çš„ã€åŒ…å«ä¼˜å…ˆçº§å¤„ç†çš„â€œè°ƒåº¦åœºâ€ç®—æ³•ã€‚
///
/// é€šè¿‡è¿™ç§â€œç‰¹æ®Šæƒ…å†µä¼˜å…ˆï¼Œä¸€èˆ¬æƒ…å†µç½®åŽâ€çš„ç­–ç•¥ï¼Œä½ å°±å¯ä»¥å°†æ‰€æœ‰ç‹¬ç«‹çš„è§£æžé€»è¾‘ä¼˜é›…åœ°æ•´åˆåœ¨ä¸€èµ·ã€‚
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// è¿™ä¸ªæµ‹è¯•æ–‡ä»¶åŒ…å«äº†ä¸€äº›å°†ä¸åŒè¡¨è¾¾å¼ï¼ˆå¦‚ `if` å’ŒäºŒå…ƒæ“ä½œï¼‰ç»„åˆåœ¨ä¸€èµ·çš„å¤æ‚åœºæ™¯ï¼Œ
/// æ˜¯å¯¹ä½ æœ€ç»ˆ `parse_expr` å‡½æ•°çš„ç»ˆæžè€ƒéªŒã€‚
///
/// ```bash
/// moon test -p parser -f parse_complex_expr_test.mbt
/// ```
///
/// **ç¥è´ºä½ ï¼å®Œæˆè¿™ä¸€æ­¥ï¼Œä½ çš„è¡¨è¾¾å¼è§£æžå™¨å°±çœŸæ­£å¤§åŠŸå‘Šæˆäº†ï¼** ðŸ†
/// ================================================================================

///|
test "Complex Expr Parsing Test" {
  let code =
    #|(if a > b { a; } else { b; }) + (if c < d { c; } else { d; }) ;
  let tokens = @lexer.tokenize(code)
  let (e, _) = parse_expr(tokens)
  assert_true(
    e.kind is BinaryExpr(Add, l, r) &&
    l.kind is ApplyExpr(a1) &&
    a1.kind is AtomExpr(a1) &&
    a1.kind is Paren(a1) &&
    a1.kind is IfExpr(_) &&
    r.kind is ApplyExpr(a2) &&
    a2.kind is AtomExpr(a2) &&
    a2.kind is Paren(a2) &&
    a2.kind is IfExpr(_),
  )
}
