/// ================================================================================
/// # æ§åˆ¶æµï¼šè§£æ if-else è¡¨è¾¾å¼
///
/// æˆ‘ä»¬å·²ç»å¯ä»¥è§£æçº¿æ€§çš„è¯­å¥æµäº†ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥ä¸ºè¯­è¨€å¼•å…¥ç¬¬ä¸€ä¸ªçœŸæ­£çš„**æ§åˆ¶æµ**ç»“æ„ï¼š
/// **if-else è¡¨è¾¾å¼**ã€‚
///
/// åœ¨ MiniMoonBit ä¸­ï¼Œ`if-else` å’Œä»£ç å—ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒå¯ä»¥æœ‰è¿”å›å€¼ã€‚
///
/// ## if-else çš„ EBNF èŒƒå¼
///
/// ```
/// if_expr ::= "if" expr block_expr ("else" (if_expr | block_expr))?
/// ```
///
/// è¿™æ®µèŒƒå¼æ­ç¤ºäº†ä¸€ä¸ª `if-else` ç»“æ„æœ€æœ‰è¶£çš„éƒ¨åˆ†ï¼š
/// 1.  ä»¥ `if` å…³é”®å­—å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªæ¡ä»¶ `expr` å’Œä¸€ä¸ª `then` åˆ†æ”¯çš„ `block_expr`ã€‚
/// 2.  `else` éƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚
/// 3.  å¦‚æœå­˜åœ¨ `else`ï¼Œå®ƒåé¢å¯ä»¥è·Ÿç€å¦ä¸€ä¸ª `if_expr`ï¼ˆè¿™å°±æ„æˆäº† `else if` é“¾ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªæœ€ç»ˆçš„ `block_expr`ã€‚
///
/// ## ğŸ¯ ä½ çš„ä»»åŠ¡ï¼šå®ç° `parse_if_expr`
///
/// ä½ çš„ä»»åŠ¡æ˜¯åœ¨ `parser/if_expr.mbt` ä¸­å®ç° `parse_if_expr` å‡½æ•°ã€‚
///
/// **å®ç°æ€è·¯ï¼š**
///
/// 1.  è§£æ `if`ã€æ¡ä»¶è¡¨è¾¾å¼å’Œ `then` ä»£ç å—ã€‚è¿™éƒ¨åˆ†éå¸¸ç›´æ¥ã€‚
/// 2.  æ£€æŸ¥ `then` å—åé¢æ˜¯å¦æœ‰ `else` å…³é”®å­—ã€‚
/// 3.  å¦‚æœæœ‰ `else`ï¼Œä½ éœ€è¦å†æ¬¡å‘åçœ‹ä¸€ä¸ª Tokenï¼š
///     *   å¦‚æœ `else` åé¢è·Ÿç€ `if`ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ª `else if`ï¼Œä½ åº”è¯¥**é€’å½’åœ°è°ƒç”¨ `parse_if_expr`** æ¥è§£æè¿™ä¸ªé“¾å¼ç»“æ„ã€‚
///     *   å¦‚æœ `else` åé¢è·Ÿç€ `{`ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæœ€ç»ˆçš„ `else` åˆ†æ”¯ï¼Œä½ åº”è¯¥è°ƒç”¨ `parse_block_expr` æ¥è§£æå®ƒã€‚
///
/// ### ğŸ’¡ æ•°æ®ç»“æ„æç¤ºï¼š`Either`
///
/// `else` åˆ†æ”¯æ—¢å¯èƒ½æ˜¯ `if_expr`ï¼Œä¹Ÿå¯èƒ½æ˜¯ `block_expr`ã€‚å¦‚ä½•åœ¨ä¸€ä¸ªå­—æ®µé‡Œè¡¨ç¤ºè¿™ä¸¤ç§å¯èƒ½æ€§å‘¢ï¼Ÿ
///
/// MoonBit æ ‡å‡†åº“ä¸­çš„ `Either[A, B]` ç±»å‹æ˜¯ä¸ºæ­¤åœºæ™¯é‡èº«å®šåšçš„ã€‚
/// å®ƒå¯ä»¥å­˜æ”¾ä¸¤ç§ç±»å‹çš„å€¼ä¹‹ä¸€ï¼š`Left(A)` æˆ– `Right(B)`ã€‚
///
/// åœ¨ `if_expr.mbt` ä¸­ï¼Œ`else_block` å­—æ®µçš„ç±»å‹ `Either[IfExpr, BlockExpr]?` å°±è¿ç”¨äº†è¿™ä¸ªæ€æƒ³ï¼Œ
/// ä½ å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¼˜é›…åœ°å­˜å‚¨ `else` åˆ†æ”¯çš„ä¸¤ç§å¯èƒ½æ€§ã€‚
///
/// ç›¸ä¿¡è¿™ä¸ªæŒ‘æˆ˜å¯¹ä½ æ¥è¯´å·²ç»ä¸éš¾äº†ã€‚åŠ æ²¹ï¼
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// ```bash
/// moon test -p parser -f parse_if_expr_test.mbt
/// ```
/// ================================================================================

///|
test "Parse If Expr Test" {
  let code =
    #|if a < b { return a; }
    #|if a < b { return a; } else { return b; }
    #|if a > b { a; } else if a == b { 0; } else { b; }
  let tokens = @lexer.tokenize(code)
  let (if_expr1, tok_view) = parse_if_expr(tokens[:])
  assert_true(if_expr1.then_block.stmts.length() is 1)
  assert_true(if_expr1.else_block is None)
  let (if_expr2, tok_view) = parse_if_expr(tok_view)
  assert_true(if_expr2.then_block.stmts.length() is 1)
  assert_true(if_expr2.else_block is Some(else_block) && else_block is Right(_))
  let (if_expr3, _) = parse_if_expr(tok_view)
  assert_true(if_expr3.then_block.stmts.length() is 1)
  assert_true(
    if_expr3.else_block is Some(else_block) &&
    else_block is Left(else_if) &&
    else_if.then_block.stmts.length() is 1 &&
    else_if.else_block is Some(else_block2) &&
    else_block2 is Right(_),
  )
}
