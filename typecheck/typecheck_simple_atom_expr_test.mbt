/// ================================================================================
/// # ç±»å‹æ£€æŸ¥è¡¨è¾¾å¼ï¼šä»åŸå­è¡¨è¾¾å¼å¼€å§‹
///
/// æ­å–œä½ ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å¯¹é¡¶å±‚å£°æ˜çš„ç±»å‹æ£€æŸ¥ï¼
/// ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·±å…¥ç¼–è¯‘å™¨çš„æ ¸å¿ƒè…¹åœ°ï¼š**è¡¨è¾¾å¼çš„ç±»å‹æ£€æŸ¥**ã€‚
///
/// æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯å®ç°ä¸€ä¸ª `check_expr` å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿç¡®å®šä»»ä½•å¤æ‚è¡¨è¾¾å¼çš„ç±»å‹ã€‚
/// ä½†æ­£å¦‚æˆ‘ä»¬åœ¨è¯­æ³•åˆ†æé˜¶æ®µæ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨â€œè‡ªåº•å‘ä¸Šâ€çš„ç­–ç•¥ï¼Œä»æœ€ç®€å•çš„éƒ¨åˆ†å¼€å§‹ã€‚
///
/// ## ğŸ¯ ä½ çš„ä»»åŠ¡ï¼šå®ç° `check_atom_expr`
///
/// **åŸå­è¡¨è¾¾å¼ï¼ˆAtomExprï¼‰**æ˜¯æ‰€æœ‰å¤æ‚è¡¨è¾¾å¼çš„åŸºçŸ³ã€‚
/// ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯åœ¨ `typecheck/atom_expr.mbt` æ–‡ä»¶ä¸­å®ç° `Context::check_atom_expr` å‡½æ•°ã€‚
///
/// è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªæ¥è‡ª parser çš„ `AtomExpr`ï¼Œå¹¶è¿”å›ä¸€ä¸ª**å¸¦æœ‰ç±»å‹ä¿¡æ¯**çš„æ–° `AtomExpr`ã€‚
///
/// ### ğŸ’¡ å®ç°æ€è·¯
///
/// ä½ éœ€è¦åœ¨ `check_atom_expr` ä¸­ä½¿ç”¨ `match` è¯­å¥æ¥å¤„ç†ä¸åŒç§ç±»çš„åŸå­è¡¨è¾¾å¼ï¼š
///
/// 1.  **å­—é¢é‡ï¼ˆLiteralsï¼‰ï¼š**
///     *   å¯¹äº `Int(v)`ï¼Œå…¶ç±»å‹æ˜¾ç„¶æ˜¯ `TypeKind::Int`ã€‚
///     *   å¯¹äº `Double(v)`ï¼Œå…¶ç±»å‹æ˜¯ `TypeKind::Double`ã€‚
///     *   å¯¹äº `Bool(v)`ï¼Œå…¶ç±»å‹æ˜¯ `TypeKind::Bool`ã€‚
///     *   å¯¹äº `String(s)`ï¼Œå…¶ç±»å‹æ˜¯ `TypeKind::String`ã€‚
///
/// 2.  **æ ‡è¯†ç¬¦ï¼ˆIdentifiersï¼‰ï¼š**
///     *   å¯¹äº `Ident(name)`ï¼Œæƒ…å†µå˜å¾—æœ‰è¶£èµ·æ¥ã€‚è¿™ä»£è¡¨ä¸€ä¸ªå˜é‡ã€‚
///     *   å®ƒçš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¿…é¡»åœ¨**ç±»å‹ç¯å¢ƒï¼ˆType Environmentï¼‰**ä¸­æŸ¥æ‰¾å®ƒï¼
///     *   `Context` ç»“æ„ä½“ä¸­åŒ…å«ä¸€ä¸ª `type_env` å­—æ®µï¼Œå®ƒæ˜¯ä¸€ä¸ª `Map`ï¼Œå­˜å‚¨äº†å½“å‰ä½œç”¨åŸŸå†…æ‰€æœ‰å·²çŸ¥å˜é‡çš„ç±»å‹ã€‚
///     *   ä½ éœ€è¦ä» `self.type_env` ä¸­æŸ¥æ‰¾ `name` å¯¹åº”çš„ç±»å‹ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±åº”è¯¥æŠ›å‡ºä¸€ä¸ª `TypeCheckError` é”™è¯¯ã€‚
///
/// **è¯·æ³¨æ„ï¼š**
/// æœ¬æ¬¡æŒ‘æˆ˜çš„æµ‹è¯•ç”¨ä¾‹åªåŒ…å«ä¸Šè¿°å‡ ç§æƒ…å†µã€‚ä½ æš‚æ—¶**ä¸éœ€è¦**å¤„ç† `Paren`ã€`Tuple`ã€`Array` ç­‰æ›´å¤æ‚çš„åŸå­è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å°†åœ¨åç»­çš„æŒ‘æˆ˜ä¸­é€æ­¥å®Œå–„å®ƒä»¬ã€‚
///
/// ---
///
/// **é˜¶æ®µæ€§æµ‹è¯•ï¼š**
///
/// å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€éªŒä½ çš„å®ç°ï¼š
///
/// ```bash
/// moon test -p typecheck -f typecheck_simple_atom_expr_test.mbt
/// ```
///
/// åŠ æ²¹ï¼è¿™æ˜¯æˆ‘ä»¬æ„å»ºç±»å‹æ¨æ–­å¼•æ“çš„ç¬¬ä¸€æ­¥ï¼
/// ================================================================================

///|
test "Simple Atom Expression Type Check" {
  let code =
    #|42 3.14 true "Hello" x y z
  let ctx = Context::new()
  ctx.type_env.set("x", { kind: TypeKind::Double, mutable: false })
  ctx.type_env.set("y", { kind: TypeKind::Bool, mutable: false })
  ctx.type_env.set("z", { kind: TypeKind::String, mutable: false })
  // Parse
  let tokens = @lexer.tokenize(code)
  // Type of 42
  let (a, tok_view) = @parser.parse_atom_expr(tokens[:])
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is Int)
  // Type of 3.14
  let (a, tok_view) = @parser.parse_atom_expr(tok_view)
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is Double)
  // Type of true
  let (a, tok_view) = @parser.parse_atom_expr(tok_view)
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is Bool)
  // Type of "Hello"
  let (a, tok_view) = @parser.parse_atom_expr(tok_view)
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is String)
  // Type of x
  let (a, tok_view) = @parser.parse_atom_expr(tok_view)
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is Double)
  // Type of y
  let (a, tok_view) = @parser.parse_atom_expr(tok_view)
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is Bool)
  // Type of z
  let (a, _) = @parser.parse_atom_expr(tok_view)
  let a = ctx.check_atom_expr(a)
  assert_true(a.ty is String)
}
